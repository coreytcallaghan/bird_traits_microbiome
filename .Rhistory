library(mgcv)
?s
?sos
all_dat <- read_csv("C:/Users/c.callaghan/Desktop/all_dat.csv")
##DOWNSAMPLING------------------------------------------------------
library(tidyverse)
all_dat <- read_csv("C:/Users/c.callaghan/Desktop/all_dat.csv")
sample_size <- all_dat %>%
group_by(sample) %>%
summarize(N=n()) %>%
filter(N==min(N))
run_function <- function(){
all_dat %>%
mutate(n=1) %>%
group_by(sample) %>%
slice_sample(n = sample_size$N) %>%
distinct(sample, species, n) %>%
mutate(richness=sum(n)) %>%
distinct(sample, richness) %>%
print()
}
x <- replicate(1000, run_function())
View(sample_size)
x <- replicate(10, run_function())
downsampled_data <- as.data.frame(apply(x, 2, unlist))
row.names(downsampled_data) = NULL
View(downsampled_data)
labels <- downsampled_data %>%
dplyr::select(V1) %>%
filter(V1 == c("2016-01-01",
"2016-03-01",
"2016-05-01",
"2016-07-01",
"2016-09-01",
"2016-11-01",
"2017-01-01",
"2017-03-01",
"2017-05-01",
"2017-07-01",
"2017-09-01",
"2017-11-01",
"2018-01-01",
"after")) %>%
rename(sample=V1)
resampled_data <- downsampled_data %>%
filter(V1 != c("2016-01-01",
"2016-03-01",
"2016-05-01",
"2016-07-01",
"2016-09-01",
"2016-11-01",
"2017-01-01",
"2017-03-01",
"2017-05-01",
"2017-07-01",
"2017-09-01",
"2017-11-01",
"2018-01-01",
"after")) %>%
mutate_if(is.character, as.numeric)
downsampled_bind <- cbind(labels, resampled_data) %>%
rowwise() %>%
mutate(mean = mean(c_across(V1:V1000))) %>%
mutate(sd = sd(c_across(V1:V1000)))
downsampled_bind <- cbind(labels, resampled_data) %>%
rowwise() %>%
mutate(mean = mean(c_across(V1:V1000))) %>%
mutate(sd = sd(c_across(V1:V1000)))
final_downsample <- downsampled_bind %>%
dplyr::select(sample, mean, sd) %>%
mutate(CI = 1.96*sd) %>%
mutate(qD=mean) %>%
mutate(site=sample) %>%
mutate(type="fire")
down_before <- final_downsample %>%
filter(sample != "after")
down_after <- final_downsample %>%
filter(sample == "after")
downsample_overall_plot <- ggplot() +
geom_point(data=down_after, aes(x=type, y=qD, group=site), color="orange", fill="orange", position=position_dodge(width=1),size=5, show.legend = FALSE) +
geom_errorbar(data=down_after, aes(x=type,y=qD, ymin=qD-CI, ymax=qD+CI, group=site),color="orange",  size=1, width=0.03, position=position_dodge(width=1), show.legend = FALSE)+
geom_pointrange(data=down_before, aes(x=type, y=qD, ymin=qD-CI, ymax=qD+CI, group=site),color="royalblue1",  position=position_jitter(), fill="White", size=1, show.legend = FALSE, alpha=0.2) +
theme_classic() +
theme(axis.title=element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
panel.background = element_rect(fill = "white", colour = "black"),
strip.background = element_blank(),
strip.placement = "outside",
strip.text=element_text(size=24, face = "bold"),
axis.text = element_text(size=18, color="black"),
#legend.title=element_blank(),
#legend.text=element_text(size=16),
#legend.position = c(0.9637,0.079), #0.9638 for lower richness plots
#legend.background = element_blank(),
#legend.box.background = element_rect(colour = "black"),
#legend.margin=margin(c(1,3,1.6,1))
)
downsample_overall_plot
ggsave(downsample_overall_plot , filename = paste0("DOWNSAMPLING_output_Overall.png"), path = "C:/Users/Simon Gorta/OneDrive - UNSW/bushfire_inat_frogid/Figures/Gorta_et_al/iNEXT_Figures/Before_After_Overall",
width = 5,
height = 4)
setwd("D:/Research/Projects and papers/bird_traits_microbiome/")
